{{- if .Site.IsServer -}}
<!-- Dont add Google analytics to localhost -->
{{ else }}
{{ if .Site.Params.google_analytics_id }}
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{- .Site.Params.google_analytics_id -}}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', '{{- .Site.Params.google_analytics_id -}}', { 'optimize_id': '{{- .Site.Params.google_optimize_id -}}' });
</script>

<!-- Anti-flicker snippet (recommended)  -->
<style>
  .async-hide {
    opacity: 0 !important
  }
</style>
<script>(function (a, s, y, n, c, h, i, d, e) {
  s.className += ' ' + y; h.start = 1 * new Date;
    h.end = i = function () { s.className = s.className.replace(RegExp(' ?' + y), '') };
    (a[n] = a[n] || []).hide = h; setTimeout(function () { i(); h.end = null }, c); h.timeout = c;
  })(window, document.documentElement, 'async-hide', 'dataLayer', 4000,
    { '{{- .Site.Params.google_optimize_id -}}': true });</script>
{{ end }}
{{ end }}